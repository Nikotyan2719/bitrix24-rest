---
const BITRIX24_WEBHOOK = 'https://b24-1aju79.bitrix24.ru/rest/1/u3dtj4pacn8odm62/';
---

<div class="app">
    <h2>Сравнение API Bitrix24</h2>

    <div class="sdk-result">
        <h3>Пример использования SDK</h3>
        <div id="sdkResult"></div>
    </div>

    <div class="rest-result">
        <h3>Пример использования REST API</h3>
        <div>
            <button onclick="getProfile()">Получить профиль пользователя</button>
            <button onclick="getAppInfo()">Получить информацию о приложении</button>
        </div>
        <div id="restResult" class="result"></div>
    </div>
</div>

<style>
    .result {
        margin: 10px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }
    button {
        padding: 8px 15px;
        cursor: pointer;
        background-color: blanchedalmond;
    }
    .sdk-result, .rest-result {
        margin: 20px;
    }
</style>

<!-- Подключение Bitrix24 SDK -->
<script is:inline>
// Подключаем внешний скрипт
const script = document.createElement('script');
script.src = '//api.bitrix24.com/api/v1/';
script.async = true;
document.head.appendChild(script);

// Функции для REST API
async function callBitrixAPI(method, params = {}) {
    try {
        const response = await fetch(`https://b24-1aju79.bitrix24.ru/rest/1/u3dtj4pacn8odm62/${method}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams(params)
        });

        const result = await response.json();
        if (result.error) {
            throw new Error(result.error_description || result.error);
        }
        return result;
    } catch (error) {
        console.error('Ошибка REST API:', error);
        throw error;
    }
}

function displayRestResult(title, data) {
    const restResult = document.getElementById('restResult');
    if (Array.isArray(data)) {
        restResult.innerHTML = `<h4>${title}</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
    } else {
        restResult.innerHTML = `<h4>${title}</h4><pre>${JSON.stringify(data, null, 2)}</pre>`;
    }
}

function displayRestError(message) {
    const restResult = document.getElementById('restResult');
    restResult.innerHTML = `<div style="color: red;">Ошибка: ${message}</div>`;
}

// Методы REST API
async function getProfile() {
    try {
        const result = await callBitrixAPI('profile', {});
        displayRestResult('Профиль пользователя', result.result);
    } catch (error) {
        displayRestError(error.message);
    }
}

async function getAppInfo() {
    try {
        const result = await callBitrixAPI('app.info', {});
        displayRestResult('Информация о приложении', result.result);
    } catch (error) {
        displayRestError(error.message);
    }
}

// Инициализация SDK
BX24.init(function(){
    // Пример использования SDK
    BX24.callMethod('app.info', {}, function(res){
        if (res.error()) {
            console.error('Ошибка SDK:', res.error());
        } else {
            const sdkResult = document.getElementById('sdkResult');
            const data = res.data();
            sdkResult.innerHTML = `
                <h4>Информация о приложении (SDK)</h4>
                <div>ID приложения: ${data.ID}</div>
                <div>Код: ${data.CODE}</div>
                <div>Установлено: ${data.INSTALLED ? 'Да' : 'Нет'}</div>
                <div>Лицензия: ${data.LICENSE}</div>
                <div>Тип лицензии: ${data.LICENSE_TYPE}</div>
                <div>Дней осталось: ${data.DAYS}</div>
                <div>Статус: ${data.STATUS}</div>
                <div>Версия: ${data.VERSION}</div>
            `;
        }
    });

    console.log('SDK готов к работе!', BX24.isAdmin());
});
</script>